/*!
 * jQuery Data Table Plugin v1.2
 *
 * Author: Jeff Dupont
 * ==========================================================
 * Copyright 2012 iAcquire, LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ==========================================================
 */(function(a){function c(){var b=this.options,c=this.$element,d=this.$top_details,e=a("<a></a>"),f=this;return this.$column_modal||(this.$column_modal=a("<div></div>").attr("id","dt-column-modal_"+Math.floor(Math.random()*100+1)).addClass("modal").hide(),this.$column_modalheader=a("<div></div>").addClass("modal-header").append(a("<button></button>").addClass("close").data("dismiss","modal").text("x").click(function(){f.$column_modal.modal("hide")})).append(a("<h3></h3>").text("Toggle Columns")),this.$column_modalfooter=a("<div></div>").addClass("modal-footer").append(a("<a></a>").attr("href","#").addClass("btn btn-primary").text("Save").click(function(){l.call(f)})),this.$column_modalbody=a("<div></div>").addClass("modal-body"),this.$column_modal.append(this.$column_modalheader,this.$column_modalbody,this.$column_modalfooter).appendTo(document.body)),e.addClass("btn").data("toggle","modal").attr("href","#"+this.$column_modal.attr("id")).html('<i class="icon-cog"></i>').click(function(){f.$column_modal.on("show",function(){j.call(f,f.$column_modalbody)}).modal()}),this.buttons.unshift(e),this.$column_modal}function d(){var b=this.options,c=this.$element,d=a("<a></a>");b.filterModal.hide(),d.addClass("btn").data("toggle","modal").attr("href","#").html('<i class="icon-filter"></i>').click(function(){a(b.filterModal).modal()}),this.buttons.unshift(d)}function e(){var b=this.options,c=this.$element,d=this,e=a("<a></a>").addClass("btn dropdown-toggle").attr("data-toggle","dropdown").html(b.perPage+"&nbsp;").append(a("<span></span>").addClass("caret"));this.buttons.push(e);var f=a("<ul></ul>").addClass("dropdown-menu").append(a('<li data-value="5"><a href="#">5</a></li>').click(function(){g.call(this,d)}),a('<li data-value="10"><a href="#">10</a></li>').click(function(){g.call(this,d)}),a('<li data-value="20"><a href="#">20</a></li>').click(function(){g.call(this,d)}),a('<li data-value="50"><a href="#">50</a></li>').click(function(){g.call(this,d)}),a('<li data-value="100"><a href="#">100</a></li>').click(function(){g.call(this,d)}));this.buttons.push(f)}function f(){var b=this.options,c=this.$element,d=a("<a></a>");d.addClass("btn").attr("href","#").html('<i class="icon-info-sign"></i>');var e=[],f=[];a.each(b.sort,function(a,c){var d;for(column in b.columns)b.columns[column].field==c[0]&&(d=b.columns[column].title);e.push(d+" "+c[1].toUpperCase())}),a.each(b.filter,function(a,c){var d;for(column in b.columns)b.columns[column].field==a&&(d=b.columns[column].title);f.push(d+" = '"+c+"'")}),a(d).popover({placement:"bottom",content:a("<dl></dl>").append(e.length>0?'<dt><i class="icon-th-list"></i> Sort:</dt><dd>'+e.join(", ")+"</dd>":"",b.showFilter&&f.length>0?'<dt><i class="icon-filter"></i> Filter:</dt><dd>'+f.join(", ")+"</dd>":"")}),this.buttons.unshift(d)}function g(b){var c=b.options;c.perPage=a(this).data("value");var d=c.currentPage*c.perPage;while(d>c.totalRows)c.currentPage--,d=c.currentPage*c.perPage;a(this).popover&&a(this).popover("hide"),b.render()}function h(){var a=this.options,b=this.$element;b.empty(),this.$default&&b.append(this.$default)}function i(b){var c=b.options;c.filter[a(this).data("filter")]=a(this).val(),b.render()}function j(b){var c=this.options,d=a("<fieldset></fieldset>"),e=this;for(column in c.columns){var f=a('<div class="control-group" style="float: left" data-column="'+column+'"><label class="control-label">'+c.columns[column].title+'</label><div class="controls"><div class="btn-group" data-toggle="buttons-radio"><a href="#" class="btn '+(c.columns[column].hidden?"":"active")+'"><i class="icon-ok"></i></a><a href="#" class="btn '+(c.columns[column].hidden?"active":"")+'"><i class="icon-remove"></i></a></div></div></div>').click(function(){k.call(this,e)});d.append(f)}b.empty(),b.append(a("<form></form>").addClass("form-horizontal").append(d))}function k(b){var c=b.options,d=a(this).data("column"),e=a("."+c.columns[d].classname);e.is(":visible")?(e.hide(),c.columns[d].hidden=!0):(e.show(),c.columns[d].hidden=!1),a(this).find("a.active").removeClass("active"),c.columns[d].hidden?a(this).find(".icon-remove").parent().addClass("active"):a(this).find(".icon-ok").parent().addClass("active")}function l(){var b=this.options,c=[];localStorage&&(localStorage["datatable_"+(b.id||b.url.replace(/\W/ig,"_"))]=b.columns),a.ajax({url:b.url,type:"POST",dataType:"json",data:{action:"saveColumns",columns:JSON.stringify(b.columns),sort:JSON.stringify(b.sort),filter:JSON.stringify(b.filter)},success:function(a){b.debug&&console.log("columns saved")}}),this.$column_modal.modal("hide")}var b=function(b,c){this.$element=a(b),this.options=c,this.enabled=!0,this.columns=[],this.rows=[],this.buttons=[];for(column in this.options.columns)typeof this.options.columns[column].sortable===undefined&&(this.options.columns[column].sortable=!0);this.$default=this.$element.children().length?this.$element.children():a("<div></div>").addClass("alert alert-error").html("No Results Found"),this.render()};b.prototype={constructor:b,render:function(){var b=this.options,g=this.$element;this.loading(!0),this.columns=[],this.rows=[],this.buttons=[],this.$table=undefined,this.$header=undefined,this.$body=undefined,this.$footer=undefined,this.$pagination=undefined,this.$toolbar&&this.$toolbar.remove(),this.$top_details=a("<div></div>").attr("id","dt-top-details"),this.$bottom_details=a("<div></div>").attr("id","dt-bottom-details");var i=this;b.url!=""&&a.ajax({url:b.url,type:"POST",dataType:"json",data:{currentPage:b.currentPage,perPage:b.perPage,sort:b.sort,filter:b.filter},success:function(a){i.resultset=a;if(a.data.length==0){i.$default&&(g.empty(),g.html(i.$default));return}g.empty(),b.sort=a.sort,b.filter=a.filter,b.totalRows=a.totalRows,a.currentPage&&(b.currentPage=parseInt(a.currentPage)),g.append(i.table()),g.prepend(i.$top_details),g.append(i.$bottom_details),b.showHeader&&i.header(),b.showFooter&&i.footer(),i.body(),b.showTopPagination&&i.pagination()&&i.$top_details.append(i.pagination().clone(!0)),b.showPagination&&i.pagination()&&i.$bottom_details.append(i.pagination().clone(!0)),i.details(),e.call(i),b.filterModal&&d.call(i),b.toggleColumns&&c.call(i),f.call(i),i.toolbar(),i.loading(!1)},error:function(a){b.debug&&console.log(a),h.call(i),i.loading(!1)}})},loading:function(b){var c=this.$element;this.$loading||(this.$loading=a("<div></div>").css({position:"absolute",top:parseInt(c.position().top)+Math.floor(c.height()/2),left:parseInt(c.position().left)+parseInt(c.css("marginLeft"))+Math.floor(c.width()/4),width:Math.floor(c.width()/2)+"px"}).append(a("<div></div>").addClass("progress progress-striped active").append(a('<div class="bar" style="width: 100%"></div>'))).appendTo(document.body)),b?c.css({opacity:.2}):(c.css({opacity:1}),this.$loading.remove(),this.$loading=undefined)},toolbar:function(){var b=this.options,c=this.$element,d=this;this.$toolbar=a("<div></div>").addClass("dt-toolbar btn-toolbar pull-right"),this.$button_group=a("<div></div>").addClass("btn-group").appendTo(this.$toolbar);for(var e=0;e<b.buttons.length;e++)this.buttons.push(b.buttons[e]);return a.each(this.buttons,function(){d.$button_group.append(this)}),b.sectionHeader?(this.$section_header=a(b.sectionHeader),this.$section_header.append(this.$toolbar)):b.title!=""&&!this.$section_header?(this.$section_header=a("<h2></h2>").text(b.title).append(this.$toolbar),c.before(this.$section_header)):this.$section_header.append(this.$toolbar),this.$toolbar},details:function(){var b=this.options,c=this.resultset,d=0,e=0,f=this;d=b.currentPage*b.perPage-b.perPage+1,e=b.currentPage*b.perPage,e>b.totalRows&&(e=b.totalRows),a('<div class="pull-left"><p>Showing '+d+" to "+e+" of "+b.totalRows+" rows</p></div>").prependTo(this.$bottom_details)},table:function(){var b=this.$element;return this.$table||(this.$table=a("<table></table>").addClass("table table-striped"),b.html(this.$table)),this.$table},header:function(){var b=this.options,c=this.resultset;if(!this.$header){this.$header=a("<thead></thead>");for(column in b.columns){var d=this.column(column);b.columns[column].sortable&&!b.columns[column].custom&&d.click(this,this.sort).css({cursor:"pointer"});for(var e=0;e<b.sort.length;e++)b.sort[e][0]==b.columns[column].field&&(b.sort[e][1]=="asc"?d.append(a(b.ascending)):b.sort[e][1]=="desc"&&d.append(a(b.descending)));this.$header.append(d),this.columns.push(d)}this.table().append(this.$header)}return this.$header},footer:function(){var b=this.resultset;return this.$footer||(this.$footer=a("<tfoot></tfoot>"),this.table().append(this.$footer)),this.$footer},body:function(){var b=this.resultset,c=this.options;if(!this.$body){this.$body=a("<tbody></tbody>");for(var d=0;d<b.data.length;d++){var e=this.row(b.data[d]);this.$body.append(e),this.rows.push(e)}c.showFilterRow&&this.$body.prepend(this.filter()),this.table().append(this.$body)}return this.$body},filter:function(){var b=a("<tr></tr>"),c=this.options,d=this;b.addClass("dt-filter-row");for(column in c.columns){var e=a("<td></td>").addClass(c.columns[column].classname);c.columns[column].hidden&&e.hide(),c.columns[column].filter&&c.columns[column].field&&e.append(a("<input/>").attr("name","filter_"+c.columns[column].field).data("filter",c.columns[column].field).val(c.filter[c.columns[column].field]||"").change(function(a){i.call(this,d)})),b.append(e)}return b},row:function(b){var c=a("<tr></tr>"),d=this.options;for(column in d.columns){var e=this.cell(b,column);c.append(e)}return d.rowCallback&&typeof d.rowCallback=="function"&&(c=d.rowCallback(c)),c},cell:function(b,c){var d=b[this.options.columns[c].field]||this.options.columns[c].custom,e=a("<td></td>"),f=this.options;return f.columns[c].callback&&typeof f.columns[c].callback=="function"&&(d=f.columns[c].callback(b,f.columns[c])),e.data("cell_properties",f.columns[c]).addClass(f.columns[c].classname).html(d||"&nbsp;"),f.columns[c].hidden&&e.hide(),e},column:function(b){var c=a("<th></th>"),d=this.options,e="dt-column_"+b+Math.floor(Math.random()*1e3+1);return d.columns[b].classname=e,c.data("column_properties",d.columns[b]).addClass(e).text(d.columns[b].title),d.columns[b].hidden&&c.hide(),c},sort:function(b){var c=a(this).data("column_properties"),d=b.data,e=b.data.options,f=!1;c.sortOrder=c.sortOrder?c.sortOrder=="asc"?"desc":"":"asc";for(var g=0;g<e.sort.length;g++)e.sort[g][0]==c.field&&(e.sort[g][1]=c.sortOrder,c.sortOrder==""&&e.sort.splice(g,1),f=!0);f||e.sort.push([c.field,c.sortOrder]),d.render()},pagination:function(){var b=this.$element,c=this,d=this.options,e=this.resultset;if(d.perPage>=e.totalRows)return;if(!this.$pagination){this.$pagination=a("<div></div>").addClass("pagination pagination-right"),d.pageCount=Math.ceil(e.totalRows/d.perPage);var f=a("<ul></ul>"),g=a("<li></li>").append(a("<a></a>").attr("href","#").data("page",1).html("&larr; First").click(function(){d.currentPage=1,c.render()})),h=a("<li></li>").append(a("<a></a>").attr("href","#").data("page",d.currentPage-1).text("Prev").click(function(){d.currentPage-=1,c.render()})),i=a("<li></li>").append(a("<a></a>").attr("href","#").data("page",d.currentPage+1).text("Next").click(function(){d.currentPage+=1,c.render()})),j=a("<li></li>").append(a("<a></a>").attr("href","#").data("page",d.pageCount).html("Last &rarr;").click(function(){d.currentPage=d.pageCount,c.render()})),k=d.pagePadding*2,l,m;k>=d.pageCount?(l=1,m=d.pageCount):(l=d.currentPage-d.pagePadding,l<=0&&(l=1),m=l+k,m>d.pageCount&&(m=d.pageCount,l=m-k));for(var n=l;n<=m;n++){var o=a("<li></li>").append(a("<a></a>").attr("href","#").data("page",n).text(n).click(function(){d.currentPage=a(this).data("page"),c.render()}));n==d.currentPage&&o.addClass("active"),f.append(o)}d.currentPage==1&&(g.addClass("disabled"),h.addClass("disabled")),d.currentPage==d.pageCount&&(i.addClass("disabled"),j.addClass("disabled")),f.prepend(g,h),f.append(i,j),this.$pagination.append(f)}return this.$pagination}},a.fn.datatable=function(c){return a.fn.datatable.init.call(this,c,b,"datatable"),this},a.fn.datatable.init=function(b,c,d){function f(e){var f=a.data(e,d);return f||(f=new c(e,a.fn.datatable.elementOptions(e,b)),a.data(e,d,f)),f}var e;return b===!0?this.data(d):typeof b=="string"?(e=this.data(d),e&&e[b](),this):(b=a.extend({},a.fn[d].defaults,b),this.each(function(){f(this)}),this)},a.fn.datatable.DataTable=b,a.fn.datatable.elementOptions=function(b,c){return a.metadata?a.extend({},c,a(b).metadata()):c},a.fn.datatable.defaults={debug:!1,id:undefined,title:"Data Table Results",perPage:10,pagePadding:2,sort:[[]],filter:{},buttons:[],sectionHeader:undefined,totalRows:0,currentPage:1,showPagination:!1,showTopPagination:!1,showHeader:!0,showFooter:!1,showFilterRow:!1,filterModal:undefined,allowExport:!1,toggleColumns:!0,url:"",columns:[],ascending:'<i class="icon-chevron-up"></i>',descending:'<i class="icon-chevron-down"></i>',rowCallback:undefined}})(window.jQuery);